<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Base-10 Addition/Subtraction with Regrouping</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin:0; padding:0;
  background: #f9f9f9;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height: 100vh;
}

h2 { margin: 20px 0; text-align:center; }

#controls {
  margin-bottom: 20px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
}

input, button, select {
  font-size: 16px;
  padding: 5px 10px;
}

#availableBlocks {
  margin-bottom: 20px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
}

.block {
  cursor: pointer;
  user-select: none;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  color:#fff;
  border-radius:4px;
  transition: transform 0.1s;
}

.flat { background:#f06; width:200px; height:200px; }
.rod  { background:#0a0; width:20px; height:200px; }
.unit { background:#06f; width:20px; height:20px; }

#board {
  display:flex;
  gap:20px;
  border:2px solid #333;
  background:#fff;
  padding:20px 10px 60px 10px;
  justify-content:flex-start;
  min-width: 90vw;
}

.column {
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  border-left:1px solid #333;
  min-height: 250px;
  position:relative;
  flex-wrap: wrap;
  gap:5px;
  padding-top:30px;
}
.column:first-child { border-left:none; }

.column-label {
  position:absolute;
  top:0;
  width:100%;
  text-align:center;
  font-weight:bold;
}

.row-blocks {
  display:flex;
  gap:5px;
  margin-bottom:5px;
}

#equation {
  margin-top:40px;
  font-size:36px;
  text-align:center;
}
</style>
</head>
<body>

<h2>Base-10 Addition/Subtraction with Regrouping</h2>

<div id="controls">
  <label>Problem: <input type="text" id="problemInput" value="246 + 175"></label>
  <button id="setup">Set Up</button>
  <button id="switchRow">Switch Number</button>
  <select id="operation">
    <option value="add">Addition</option>
    <option value="subtract">Subtraction</option>
  </select>
</div>

<div id="availableBlocks">
  <div class="block flat" data-value="100">100</div>
  <div class="block rod" data-value="10">10</div>
  <div class="block unit" data-value="1">1</div>
</div>

<div id="board">
  <div class="column" id="hundredsCol"><div class="column-label">Hundreds</div></div>
  <div class="column" id="tensCol"><div class="column-label">Tens</div></div>
  <div class="column" id="onesCol"><div class="column-label">Ones</div></div>
</div>

<div id="equation">
  ___ ___ ___ + ___ ___ ___ = ___ ___ ___
</div>

<script>
const problemInput = document.getElementById('problemInput');
const setupBtn = document.getElementById('setup');
const switchRowBtn = document.getElementById('switchRow');
const operationSelect = document.getElementById('operation');
const availableBlocks = document.querySelectorAll('#availableBlocks .block');

const cols = {
  flat: document.getElementById('hundredsCol'),
  rod: document.getElementById('tensCol'),
  unit: document.getElementById('onesCol')
};

let currentRow = 1; // 1 = first number, 2 = second number

function clearBoard() {
  Object.values(cols).forEach(col => col.innerHTML = '<div class="column-label">'+col.querySelector('.column-label').innerText+'</div>');
}

// --- Get or create row container ---
function getRowContainer(col) {
  let rowContainer = col.querySelector(`.row${currentRow}`);
  if(!rowContainer){
    rowContainer = document.createElement('div');
    rowContainer.classList.add('row-blocks','row'+currentRow);
    col.appendChild(rowContainer);
  }
  return rowContainer;
}

// --- Add block to column ---
function addBlockToColumn(type){
  const block = document.createElement('div');
  block.classList.add('block', type);
  block.dataset.value = type==='flat'?100:type==='rod'?10:1;
  block.innerText = ''; // start blank

  // Click to reveal
  block.addEventListener('click', ()=>{
    if(block.innerText==='') block.innerText = block.dataset.value;
  });

  // Drag & drop for regrouping
  block.draggable = true;
  block.addEventListener('dragstart', e=>{
    e.dataTransfer.setData('text/plain', JSON.stringify({type:block.className.split(' ')[1], row:currentRow}));
  });

  const rowContainer = getRowContainer(cols[type]);
  rowContainer.appendChild(block);
}

// --- Column drop behavior for regrouping ---
Object.values(cols).forEach(col => {
  col.addEventListener('dragover', e=>e.preventDefault());
  col.addEventListener('drop', e=>{
    e.preventDefault();
    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
    const oldType = data.type;
    const row = data.row;
    const targetType = col.id==='hundredsCol'?'flat':col.id==='tensCol'?'rod':'unit';

    const oldCol = cols[oldType];
    const rowContainer = oldCol.querySelector(`.row${row}`);
    const blocks = Array.from(rowContainer.querySelectorAll(`.${oldType}`));

    // --- Regrouping logic ---
    if(oldType === targetType) return; // do nothing if same type

    if(oldType==='unit' && targetType==='rod'){
      if(blocks.length >= 10){
        for(let i=0;i<10;i++) blocks[i].remove();
        addBlockToColumn('rod');
      }
    } else if(oldType==='rod' && targetType==='unit'){
      if(blocks.length >= 1){
        blocks[0].remove();
        for(let i=0;i<10;i++) addBlockToColumn('unit');
      }
    } else if(oldType==='rod' && targetType==='flat'){
      if(blocks.length >= 10){
        for(let i=0;i<10;i++) blocks[i].remove();
        addBlockToColumn('flat');
      }
    } else if(oldType==='flat' && targetType==='rod'){
      if(blocks.length >=1){
        blocks[0].remove();
        for(let i=0;i<10;i++) addBlockToColumn('rod');
      }
    }
  });
});

// --- Available block click ---
availableBlocks.forEach(b => {
  b.addEventListener('click', ()=>{
    const type = b.classList.contains('flat')?'flat':b.classList.contains('rod')?'rod':'unit';
    addBlockToColumn(type);
  });
});

// --- Setup button ---
setupBtn.addEventListener('click', ()=>{
  clearBoard();
  currentRow = 1;
  document.getElementById('equation').innerText = problemInput.value.replace(/\d+/g,'___');
});

// --- Switch row button ---
switchRowBtn.addEventListener('click', ()=>{
  currentRow = currentRow===1?2:1;
});
</script>

</body>
</html>


